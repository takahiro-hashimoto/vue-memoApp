<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>画像系SNS一括検索</title>
</head>
<link rel='stylesheet' type='text/css' href='dst/css/style.css' media='all' />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="src/script/jquery.freetile.min.js"></script>

<body>

  <h1>画像系SNS一括検索</h1>

  <input type="text" id="js-keyword" name="word">
  <button id="js-submit">検索</button>

  <div id="js-renderArea"></div>

<script>

// var flikerKey = 810bb5cc29752cddd56088dff2b75e02;
// var flikerSecret =  e6d3c1dc6f6c87f6;

// var 500pxKey = G6kID8IZ5fg58bOL32mvffjAFT3gk9TBY13e8OjQ;
// var 500pxSecret = J4Utz9M7H78xJD6Lx2D9MjcppKFqR3AR1gqN1h7z;

//HTML要素の登録
const renderArea = document.getElementById('js-renderArea');
const keyword = document.getElementById('js-keyword');
const submit = document.getElementById('js-submit');

//検索ボタンにイベントをつける
submit.addEventListener('click', searchPhoto, false);

//リクエストURIの生成
const server = 'https://api.500px.com/v1/photos/search';
const apiKey = '?consumer_key=G6kID8IZ5fg58bOL32mvffjAFT3gk9TBY13e8OjQ';
const imageSize = '&image_size=20'
const searchURI = server + apiKey + imageSize + '&term=';

//検索開始（検索ボタンクリック後）
function searchPhoto(){
  keyword.textContent = '';
  let query = encodeURIComponent(keyword.value.trim());
  let requestURI = searchURI + query;
  $.ajax({
     type: 'GET',
     dataType: 'json',
     url: requestURI,
     success: function(data){
       render(data);
     },
     error: function(xhr, textStatus, errorThrown){
       console.log('hoge')
     }
   });
}

function render(data) {
  renderArea.textContent = '';
  for (var i = 0, count = data.photos.length; i < count; i++) {
      var url = data.photos[i].image_url;
      var template = $('<img class="photo"' +  'src="' + url + '">');
      $('#js-renderArea').append(template);
      $('#js-renderArea').freetile({selector: '.photo'});
  }
  // if(photos.length == 0){
  //   photoArea.textContent = notFoundMessage;
  // }
}

  // function searchPhoto(){
  //   $.ajax({
  //     type: "GET",
  //     dataType: "json",
  //       url: "https://api.500px.com/v1/photos/search?consumer_key=G6kID8IZ5fg58bOL32mvffjAFT3gk9TBY13e8OjQ&term=%E4%B8%8B%E7%81%98%E9%A7%85&image_size=440",
  //     success: function(result){
  //       console.log(result)
  //     },
  //     error: function(xhr, textStatus, errorThrown){
  //       console.log('hoge')
  //     }
  //   });
  // }
  // requestSearch();


</script>

</body>
</html>
