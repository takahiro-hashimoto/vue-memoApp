<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>memoApps</title>
</head>
<link rel='stylesheet' type='text/css' href='dst/css/style.css' media='all' />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<body>

<div id="js-app">

  <div class="header clearfix">
    <h1 class="header-title l-left">memoApps</h1>
    <button class="l-header-button header-button" type="button" v-on:click="addModal=!addModal">
      <i class="fa fa-plus-square-o" aria-hidden="true"></i>
    </button>
  </div>

  <div class="content">
    <ul id="js-content-list" class="l-content-list content-list">
      <li class="js-content-item content-item" v-on:click="preview(item)" v-for="item in items">
        <div class="content-item-title" v-html="item.title"></div>
        <div class="js-content-button-container content-button-container is-hide">
          <button class="content-button l-content-button-edit" v-on:click="editModal=!editModal" type="button">
            <i class="fa fa-pencil" aria-hidden="true"></i>
          </button>
          <button class="content-button l-content-button-delete" v-on:click="deleteItem(item)" type="button">
            <i class="fa fa-trash-o" aria-hidden="true"></i>
          </button>
        </div>
      </li>
    </ul>
    <div id="js-content-preview" class="l-content-preview content-preview">
      <div class="contet-preview-title l-bottom-xlarge" v-html="selectedItem.title" type="text"></div>
      <div class="compiledArea" v-html="selectedItem.compiledText" type="text"></div>
    </div>
  </div>

  <!-- modal for addItem ▼-->
  <div class="editor" v-bind:class="{show: addModal}">
    <div class="editor-header l-bottom-midium">
      <input class="editor-title" v-model="itemTitle" type="text" placeholder="タイトルを入力してください">
    </div>
    <div class="editor-content clearfix l-bottom-midium">
      <div class="editor-input">
        <textarea class="editor-textarea" v-model="originalText" v-bind:value="input" v-on:input="update"></textarea>
      </div>
      <div class="editor-preview compiledArea">
        <div id="js-add-compiled" v-html="compiledMarkdown">
        </div>
      </div>
    </div>
    <div class="editor-bottom">
      <button class="button button-edit" v-on:click="addItem(), addModal=!addModal" type="button" name="button">保存</button>
      <button class="button button-close" v-on:click="addModal=!addModal" type="button" name="button">閉じる</button>
    </div>
  </div>
  <div class="overlay" v-bind:class="{show: addModal}" v-on:click="addModal=!addModal"></div>
  <!-- modal for addItem ▲-->

  <!-- modal for editItem ▼-->
  <div class="editor" v-bind:class="{show: editModal}">
    <div class="editor-header l-bottom-midium">
      <input class="editor-title" v-model="selectedItem.title" type="text" placeholder="タイトルを入力してください">
    </div>
    <div class="editor-content clearfix l-bottom-midium">
      <div class="editor-input">
        <textarea class="editor-textarea" v-model="selectedItem.originalText" v-bind:value="input" v-on:input="update"></textarea>
      </div>
      <div class="editor-preview compiledArea">
        <div id="js-edit-compiled" v-html="compiledMarkdown"></div>
      </div>
    </div>
    <div class="editor-bottom">
      <button class="button button-save" v-on:click="editItem(), editModal=!editModal" type="button" name="button">変更</button>
      <button class="button button-close" v-on:click="editModal=!editModal" type="button" name="button">閉じる</button>
    </div>
  </div>
  <div class="overlay" v-bind:class="{show: editModal}" v-on:click="editModal=!editModal"></div>
  <!-- modal for editItem ▲-->

</div>

<script>
$(document).on('mouseover', '.js-content-item', function() {
  $(this).children('.js-content-button-container').removeClass('is-hide');
});
$(document).on('mouseout', '.js-content-item', function() {
  $(this).children('.js-content-button-container').addClass('is-hide');
});
var app = new Vue({
  el: '#js-app',
  data: {
    items: [
      {title: '見出し', originalText: '# 見出し1\n## 見出し2\n### 見出し3\n#### 見出し4\n##### 見出し5\n###### 見出し6', compiledText: '<h1 id=\"-1\">見出し1</h1>\n<h2 id=\"-2\">見出し2</h2>\n<h3 id=\"-3\">見出し3</h3>\n<h4 id=\"-4\">見出し4</h4>\n<h5 id=\"-5\">見出し5</h5>\n<h6 id=\"-6\">見出し6</h6>\n'},
      {title: 'リスト', originalText: '- リスト1\n - ネスト リスト1_1\n - ネスト リスト1_1_1\n - ネスト リスト1_1_2\n - ネスト リスト1_2\n- リスト2\n- リスト3', compiledText: "<ul>\n<li>リスト1<ul>\n<li>ネスト リスト1_1<ul>\n<li>ネスト リスト1_1_1</li>\n<li>ネスト リスト1_1_2</li>\n</ul>\n</li>\n<li>ネスト リスト1_2</li>\n</ul>\n</li>\n<li>リスト2</li>\n<li>リスト3</li>\n</ul>\n"},
      {title: 'テーブル', originalText: '|header1|header2|header3|\n|:--|--:|:--:|\n|align left|align right|align center|\n|a|b|c|', compiledText: '<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">header1</th>\n<th style=\"text-align:right\">header2</th>\n<th style=\"text-align:center\">header3</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">align left</td>\n<td style=\"text-align:right\">align right</td>\n<td style=\"text-align:center\">align center</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">a</td>\n<td style=\"text-align:right\">b</td>\n<td style=\"text-align:center\">c</td>\n</tr>\n</tbody>\n</table>\n'},
    ],
    selectedItem: {
      title: '見出し',
      compiledText: '<h1 id=\"-1\">見出し1</h1>\n<h2 id=\"-2\">見出し2</h2>\n<h3 id=\"-3\">見出し3</h3>\n<h4 id=\"-4\">見出し4</h4>\n<h5 id=\"-5\">見出し5</h5>\n<h6 id=\"-6\">見出し6</h6>\n',
      originalText: '# 見出し1\n## 見出し2\n### 見出し3\n#### 見出し4\n##### 見出し5\n###### 見出し6',
    },
    input: '',
    addModal: false,
    editModal: false
  },
  methods: {
    preview: function(item){
      this.selectedItem = item;
    },
    update: function(eventObject){
      this.input = eventObject.target.value;
    },
    addItem: function(){
      var newTitle = this.itemTitle;
      var newOriginalText = this.originalText;
      var newCompiledText = this.compiledMarkdown;
      var addCompiled = document.getElementById('js-add-compiled');
      var editCompiled = document.getElementById('js-edit-compiled');
      if(!newTitle && !newOriginalText){
        return;
      }
      this.items.push(
        {title: newTitle, originalText: newOriginalText, compiledText: newCompiledText}
      );
      this.itemTitle = '';
      this.originalText  = '';
      editCompiled.innerHTML = '';
      addCompiled.innerHTML = '';
    },
    deleteItem: function(item){
      var index = this.items.indexOf(item);
      this.items.splice(index, 1);
    },
    editItem: function(item){
      var updatedText = this.compiledMarkdown;
      var editCompiled = document.getElementById('js-edit-compiled');
      var addCompiled = document.getElementById('js-add-compiled');
      this.selectedItem.compiledText = updatedText;
      this.compiledMarkdown = '';
      editCompiled.innerHTML = '';
      addCompiled.innerHTML = '';
    }
  },
  computed: {
    compiledMarkdown:function(){
      return marked(this.input);
    }
  }
})
</script>

</body>
</html>
